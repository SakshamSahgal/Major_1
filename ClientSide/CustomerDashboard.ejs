<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Dashboard</title>
    <script>
        let selectedHouse = null;
        function selectHouse(name) {
            alert(name + " Selected!");
            console.log(name);
            if(selectedHouse != null) 
                document.getElementById(selectedHouse).setAttribute("fill","#ffffff"); // Resetting the previous selected house
            
            selectedHouse = name;
            document.getElementById(selectedHouse).setAttribute("fill","red");
            document.getElementById("HouseSelected").innerHTML = name;
          }
    </script>
</head>

<%- include('./ReusableComponents/BootstrapCDN.ejs') %>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-success py-4">
        <div class="container-fluid">
            <h5>ORDER</h1>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <div id="dashboard-container" class="col-9 my-3 d-flex align-items-center justify-content-center">
                <svg class="my-3" width="1040" height="737">

                    <!-- Image Layer -->
                    <g id="imageLayer">
                        <title>Background Image</title>
                        <image cy="568.5" cx="173.66667" ry="213.66667" rx="45" xlink:href="/map.png" height="737" width="1040"/>
                    </g>
            
                 

                    <g id="redTrack" visibility="hidden">
                        <title>RedTrack Layer</title>
                        <image cy="568.5" cx="173.66667" ry="213.66667" rx="45" xlink:href="/Tracks/RedTrack.png" height="737" width="1040"/>
                    </g>
                    
                    <g id="blueTrack" visibility="hidden">
                        <title>BlueTrack Layer</title>
                        <image cy="568.5" cx="173.66667" ry="213.66667" rx="45" xlink:href="/Tracks/BlueTrack.png" height="737" width="1040"/>
                    </g>

                    <g id="greenTrack" visibility="hidden">
                        <title>GreenTrack Layer</title>
                        <image cy="568.5" cx="173.66667" ry="213.66667" rx="45" xlink:href="/Tracks/GreenTrack.png" height="737" width="1040"/>
                    </g>

                    <g id="yellowTrack" visibility="hidden">
                        <title>YellowTrack Layer</title>
                        <image cy="568.5" cx="173.66667" ry="213.66667" rx="45" xlink:href="/Tracks/YellowTrack.png" height="737" width="1040"/>
                    </g>

                    <g id="ellipseLayer">
                        <title>Ellipse Layer</title>
                        <ellipse ry="8.46154" rx="8.46154" id="house1" cy="298.82956" cx="320.71376" stroke="#000" fill="#ffffff" onclick="selectHouse('house1')"/>
                        <ellipse ry="8.46154" rx="8.46154" id="house2" cy="148.27401" cx="341.82487" stroke="#000" fill="#ffffff" onclick="selectHouse('house2')" />
                        <ellipse ry="8.46154" rx="8.46154" id="house3" cy="393.82955" cx="72.38044" stroke="#000" fill="#ffffff" onclick="selectHouse('house3')" />
                        <ellipse ry="8.46154" rx="8.46154" id="house4" cy="641.05179" cx="356.26932" stroke="#000" fill="#ffffff" onclick="selectHouse('house4')" />
                        <ellipse ry="8.46154" rx="8.46154" id="house5" cy="541.05178" cx="784.04711" stroke="#000" fill="#ffffff" onclick="selectHouse('house5')" />
                        <ellipse ry="8.46154" rx="8.46154" id="house6" cy="449.94067" cx="745.15822" stroke="#000" fill="#ffffff" onclick="selectHouse('house6')" />
                        <ellipse ry="8.46154" rx="8.46154" id="house7" cy="325.49623" cx="645.15822" stroke="#000" fill="#ffffff" onclick="selectHouse('house7')" />
                        <ellipse ry="8.46154" rx="8.46154" id="house8" cy="247.71845" cx="955.15822" stroke="#000" fill="#ffffff" onclick="selectHouse('house8')" />
                    </g>

                </svg>
            </div>
            <div class="col-3">
                <!-- Bootstrap card for the vertical list -->
                <div class="card my-3">
                    <div class="card-header text-center">Place Order</div>
                    <div class="card-body text-center">
                        <span>Selected House : </span><span id="HouseSelected">No House selected</span>
                        <br>
                        <br>
                        <button class="btn btn-info" id="SelectHouse">Select House</button>                       
                    </div>
                </div>
                <div class="card my-3">
                    <div class="card-header text-center">Tracks Through This</div>
                    <div class="card-body text-center">
                        
                        <ul class="list-group" id="tracksThroughIt">
                        </ul>
                                        
                    </div>
                </div>
            </div>

        </div>
    </div>
    
</body>
</html>
<!-- Axios CDN -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>

    // This is the function that will be called when the user clicks on the select house button
    
    document.getElementById("SelectHouse").addEventListener("click", function() {

        hideTracks();


        if(selectedHouse == null) {
            alert("Please select a house first!");
            return;
        }
        else {
            // Redirecting to the order page

            // Getting the tracks through it from the server
           axios.get("/Tracks/" + selectedHouse).then(function(response) {
            
            let tracksThroughIt = response.data[0].tracksThroughIt;
                
                console.log(response.data);
                
                let tracksThroughItHTML =   document.getElementById("tracksThroughIt"); 
                tracksThroughItHTML.innerHTML = "";
                let tracksString = "";
                for (let i = 0; i < tracksThroughIt.length; i++) {
                    console.log(tracksThroughIt[i]);       
                    tracksString += `<li class="list-group-item">${tracksThroughIt[i]} ${getColor(tracksThroughIt[i])} </li>`
                    document.getElementById(tracksThroughIt[i] + "Track").setAttribute("visibility","visible");
                }

                tracksThroughItHTML.innerHTML = tracksString;

           }).catch(function(error) {
               console.log(error);
           });
        }
    });

    function getColor(track) {
        if(track == "red") return `ðŸŸ¥`;
        else if(track == "blue") return `ðŸŸ¦`;
        else if(track == "green") return `ðŸŸ©`;
        else if(track == "yellow") return `ðŸŸ¨`;
    }

    function hideTracks() {
        document.getElementById("redTrack").setAttribute("visibility","hidden");
        document.getElementById("blueTrack").setAttribute("visibility","hidden");
        document.getElementById("greenTrack").setAttribute("visibility","hidden");
        document.getElementById("yellowTrack").setAttribute("visibility","hidden");
    }

</script>